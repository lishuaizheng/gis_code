---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r}
#install.packages('rgdal')
library(reshape2)
#install.packages('reshape')

library(reshape)
library(rgdal)
library(data.table)
library(reshape2)


importdata <- function(dirs) {
  all <- NULL
  retain <- c("Month", "Longitude", "Latitude", "LSOA.code", "LSOA.name", "Crime.type")
  for(d in dirs) {
    filename <- NULL
    #if (is.null(importdata$filename)) return()
    switch(d,
           "city-of-london-police-coord-data" = {filename <- "city-of-london-street"},
           "met-police-coord-data" = {filename <- "metropolitan-street"}
           )
    currDir <- dir(file.path("E:/UCL/005-GI System&Science/Assessment 1", d))
    for(i in currDir) {
      currFilePath <- file.path("E:/UCL/005-GI System&Science/Assessment 1", d, i, paste0(i, "-", filename,".csv"))
      currFile <- read.csv(currFilePath)
      
      currFileSub <- currFile[retain]
      currFileSub <- currFileSub[which(complete.cases(currFileSub)), ]
      if(d == "met-police-coord-data") {
        currFileSub <- currFileSub[which(currFileSub$Latitude > 51.275), ]
        currFileSub <- currFileSub[which(currFileSub$Latitude < 51.7), ]
        currFileSub <- currFileSub[which(currFileSub$Longitude > -0.53), ]
        currFileSub <- currFileSub[which(currFileSub$Longitude < 0.35), ]
      }
      
      print(dim(currFileSub))
      all <- rbind(all, currFileSub)
    }
  }
  return(all)
}


crimes <- importdata(c("city-of-london-police-coord-data", "met-police-coord-data"))
crimeTypes <- dcast(crimes, LSOA.name ~ Crime.type, value.var = "Crime.type")
colnames(crimeTypes) <- c("LSOA_name", "anti_social_behaviour", "bicycle_theft", "burglary",
                          "criminal_damage_and_arson", "drugs", "other_crime", "other_theft",
                          "possession_of_weapons", "public_order", "robbery", "shoplifting",
                          "theft_from_the_person", "vehicle_crime", "violence_and_sexual_offences")

crimesNoArea <- crimes[, c("Month", "Longitude", "Latitude", "Crime.type")]



write.csv(crimes, file = "E:/UCL/005-GI System&Science/Assessment 1/data/crimes-2018-all.csv", row.names = FALSE)
write.csv(crimesNoArea, file = "E:/UCL/005-GI System&Science/Assessment 1/data/crimes-2016-types.csv", row.names = FALSE)
write.csv(crimeTypes, file = "E:/UCL/005-GI System&Science/Assessment 1/data/crime-types.csv", row.names = FALSE)
#################################################################
library(rmarkdown)
library(rgeos)

library(sp)
library(ggplot2)
library(ggmap)
ldn1 <- readOGR(file.path("E:/UCL/005-GI System&Science/Accessment-gis/2222/London-wards-2014 (1)/London-wards-2014_ESRI/London_Ward_CityMerged.shp"), layer = "London_Ward_CityMerged")
proj4string(ldn1) <- CRS("+init=epsg:27700")
ldn1.wgs84 <- spTransform(ldn1, CRS("+init=epsg:4326"))
plot(ldn1.wgs84)
library(ggplot2)
map1 <- ggplot(ldn1.wgs84) +geom_polygon(aes(x = long, y = lat, group = group), fill = "white", colour = "black")
map1 + labs(x = "Longitude", y = "Latitude", title = "Map of Greater London with the borough boundaries")
#########################
crime <- read.csv("E:/UCL/005-GI System&Science/Assessment 1/london_crime_vehicle.csv",stringsAsFactors = F)
plot_crime <- map1+geom_jitter(aes(x=Longitude,y=Latitude,colour="grey50"),
  data=crime,alpha=0.2)+labs(x='Longitude',y='Latitude')

##################################
map1 + geom_point(data = crime, aes(x = Longitude, y = Latitude, colour = "grey50")) + scale_colour_manual(values = rainbow(14)) + labs(x = "Longitude", y = "Latitude", title = "Map of Greater London with the borough boundaries")

dec <- df[df$Month == "2016-12", ]
dec.bike <- dec[dec$Crime.type == "Bicycle theft", ]
map1 + geom_point(data = dec.bike, aes(x = Longitude, y = Latitude), colour = "red") + labs(title = "Bicycle theft in Greater London - December 2016")


```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
