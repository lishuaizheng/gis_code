---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. hjhj

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 



Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

```{r}
library(ggplot2)
library(OpenStreetMap)
install.packages('plotly')
##############################################################################
# Read the data
##############################################################################
library(maptools) 
library(RColorBrewer) 
library(classInt) 
library(OpenStreetMap) 
library(sp) 
library(rgeos) 
library(tmap)
library(tmaptools)
library(sf) 
library(rgdal)
library(geojsonio)
library(leaflet)
library(plotly)
library(ggplot2)
library(leaflet)
library(magrittr)
library(ggmap)

# read data csv. and map shp.
crime_data <- read.csv("E:/UCL/005-GI System&Science/Accessment-gis/2222/2018-08/2018-08/2018-08-metropolitan-street.csv",
               stringsAsFactors = F) 
#names(df) <- tolower(names(df))

BoroughMapSF <- read_shape("E:/UCL/005-GI System&Science/Accessment-gis/2222/statistical-gis-boundaries-london/statistical-gis-boundaries-london/ESRI/London_Ward.shp",as.sf=TRUE)
#qtm(BoroughMapSF)
#map_london <- 
#  geojson_read("http://geoportal1-ons.opendata.arcgis.com/datasets/e20b4893132e44118a51d9abaa064440_1.geojson",what="sp")
#qtm(map_london)
crime_data <- subset(df, !is.na(longitude) & !is.na(latitude))
#osmtile(x, y, zoom, type = "osm")
head(crime_data2[c('CrimeType','Longitude','Latitude','LSOAName')])
data0=crime_data2[1,]
crime_data3=data.frame(table(crime_data2$CrimeType))
crime_data3=crime_data3[order(crime_data3$Freq,decreasing=T),]
head(crime_data3)
Top3=crime_data3[c(1,1)]
head(Top3)


plot_crime <- ggmap(map)+geom_jitter(aes(Longitude,Latitude,colour=Category),
  data=crime_data[data_2014$Crime_type %in% Top3,],alpha=0.2)+geom_jitter(aes(Longitude,Latitude,colour=Crime_type),
    data=data0[data0$Category %in% Top3,],alpha=1)+labs(x='Longitude',y='Latitude')
plot_crime


```

```{r}
library(ggplot2)
library(OpenStreetMap)

# x2n5-8w5q is crimes in past year in Chicago data set
crime_data <- read.csv("E:/UCL/005-GI System&Science/Accessment-gis/2222/2018-08/2018-08/2018-08-metropolitan-street.csv",
               stringsAsFactors = F) 
#names(crime_data) <- tolower(names(crime_data))

# we don't want missing values in lat or lon
crime_data <- subset(crime_data, !is.na(Longitude) & !is.na(Latitude))


# the shape of chicago, no underlying shape, just x,y points
ggplot(crime_data) + geom_point(aes(x=Longitude, y=Latitude), alpha=.01, size=3)
p <- ggplot(crime_data, aes(Longitude, Latitude))
p + geom_point()
#ggsave("chicago_crime_map_no_underlay.jpg")

# now, let's put the shape of chicago underneath the points
rlat <- range(df$Latitude)
rlon <- range(df$Longitude)
merc <- projectMercator(df$Latitude, df$Longitude) #OSM uses mercator
# give openmap the upper right and lower left corners you want for your map



BoroughMapSF <- read_shape("E:/UCL/005-GI System&Science/Accessment-gis/2222/statistical-gis-boundaries-london/statistical-gis-boundaries-london/ESRI/London_Ward.shp",as.sf=TRUE)
qtm(BoroughMapSF )
BoroughMapSFWGS84 <- st_transform(BoroughMapSF, 4326) 
print(BoroughMapSFWGS84)
#londonbbox1 <- c(left = -0.5103766, bottom = 51.28676, right = 0.3340146, top = 51.69187) 
londonbbox2 <- as.vector(st_bbox(BoroughMapSFWGS84))
basemap <- get_stamenmap(londonbbox2, zoom = 10, maptype = "toner-lite")
plot(map)
####use the dataframe to find the highest crime type
head(crime_data[c('CrimeType','Longitude','Latitude','LSOAName')])
data0=crime_data[1,]
crime_data2=data.frame(table(crime_data$CrimeType))
crime_data2=crime_data2[order(crime_data2$Freq,decreasing=T),]
head(crime_data2)
Top3=crime_data2[c(1,14,7),1]

plot_crime <- ggmap(map)+geom_jitter(aes(x,y,colour="grey50"),
  data=crime_data2[crime_data2$CrimeType %in% Top3,],alpha=0.2)+geom_jitter(aes(x,y,colour="grey50"),
	data=data0[data0$CrimeType %in% Top3,],alpha=1)+labs(x='Longitude',y='Latitude')

plot(plot_crime)


```

```{r}
library(mapview)
add <- as.data.frame(read.csv("E:/UCL/005-GI System&Science/Assessment 1/london_crime_vehicle.csv", header = TRUE, sep = ",", dec = "."))

coordinates(add) <- ~ Longitude + Latitude
plot(add)
proj4string(add) <- CRS("+init=epsg:4326")
mapview(add)
```


```{r}
library(ggplot2)
library(OpenStreetMap)
install.packages("rmarkdown")
library('rmarkdown')
##############################################################################
# Read the data
##############################################################################

# x2n5-8w5q is crimes in past year in Chicago data set

crime_data <- as.data.frame(read.csv("E:/UCL/005-GI System&Science/Assessment 1/london_crime_vehicle.csv", header = TRUE, sep = ",", dec = "."))
coordinates(crime_data) <- ~ Longitude + Latitude
proj4string(crime_data) <- CRS("+init=epsg:4326")   ####change cooordinate system
names(crime_data) <- tolower(names(crime_data))
plot(crime_data)

crime_data2 <- read.csv("E:/UCL/005-GI System&Science/Assessment 1/london_crime_vehicle.csv",stringsAsFactors = F) 


londonmap <- ggplot(df) + geom_point(aes(x=Longitude, y=Latitude), alpha=.2, size=.9)
plot(londonmap)
geom_point
BoroughMapSF <- read_shape("E:/UCL/005-GI System&Science/Accessment-gis/2222/statistical-gis-boundaries-london/statistical-gis-boundaries-london/ESRI/London_Ward.shp",as.sf=TRUE)
qtm(BoroughMapSF )
BoroughMapSFWGS84 <- st_transform(BoroughMapSF, 4326) 
print(BoroughMapSFWGS84)
#londonbbox1 <- c(left = -0.5103766, bottom = 51.28676, right = 0.3340146, top = 51.69187) 
londonbbox2 <- as.vector(st_bbox(BoroughMapSFWGS84))
basemap <- get_stamenmap(londonbbox2, zoom = 10, maptype = "toner-lite")
plot(map)

plot_crime <- ggmap(map)+geom_jitter(aes(x,y,colour="grey50"),
  data=crime_data2[crime_data2$CrimeType %in% Top3,],alpha=0.2)+geom_jitter(aes(x,y,colour="grey50"),
	data=data0[data0$CrimeType %in% Top3,],alpha=1)+labs(x='Longitude',y='Latitude')


```
```{r}
library(ggplot2)
library(OpenStreetMap)

dfsf <- read.csv("E:/UCL/005-GI System&Science/Assessment 1/london_crime_vehicle.csv",stringsAsFactors = F) 
df<- as.data.frame(read.csv("E:/UCL/005-GI System&Science/Assessment 1/london_crime_vehicle.csv", header = TRUE, sep = ",", dec = "."))
coordinates(df) <- ~ Longitude + Latitude
proj4string(df) <- CRS("+init=epsg:4326")
plot(df)
names(df) <- tolower(names(df))

# we don't want missing values in lat or lon
#dfsf <- subset(df, !is.na(Longitude) & !is.na(Latitude))

##############################################################################
# Do some plots
##############################################################################

# the shape of chicago, no underlying shape, just x,y points
londonmap2 <- ggplot(dfsf) + geom_point(aes(Longitude, Latitude), alpha=.2, size=.9)

plot(londonmap2)
class(londonmap2)
# basemap
library(maptools)
library(rgdal)
basemap2=read_shape('E:/UCL/005-GI System&Science/Accessment-gis/2222/London-wards-2014 (1)/London-wards-2014_ESRI/London_Ward.shp',as.sf = TRUE)
qtm(basemap2)
latitude_longitude <- fortify(basemap2)
head(latitude_longitude)

BoroughDataMap <- append_data(BoroughMapSF,LondonData,key.shp="code",key.data="New.code",ignore.duplicates=TRUE)
proj4string(basemap2) <- "+proj=longlat +datum=WGS84"
proj4string(basemap2) <- CRS("+init=epsg:4326")


# give openmap the upper right and lower left corners you want for your map
mp <- openmap(c(rlat[2], rlon[1]), c(rlat[1], rlon[2]), type="osm")
autoplot(mp) + geom_point(aes(x=merc[,1], y=merc[,2]), alpha=.1, size=.9)
ggsave("chicago_crime_map_osm_underlay.jpg")
```

